FROM python:3.11-slim

# Estas libs de sistema sí ayudan a FMPy/matplotlib; el compilador ya no es obligatorio
RUN apt-get update && apt-get install -y --no-install-recommends \
    libgfortran5 libxml2 libxslt1.1 unzip \
 && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY requirements.txt /app/requirements.txt

# Verifica y elimina grpcio-tools si estuviera
RUN grep -n "grpcio-tools" /app/requirements.txt || echo "✅ no grpcio-tools" \
 && sed -i '/grpcio-tools/d' /app/requirements.txt \
 && python -m pip install --upgrade pip \
 && pip install --no-cache-dir -r /app/requirements.txt

COPY fmu_runner_opc.py /app/

ENV FMU_PATH=/app/model.fmu
ENV RESULTS_DIR=/results
ENV START_TIME=0.0
ENV STOP_TIME=10.0
ENV STEP_SIZE=1.0
ENV OPCUA_ENDPOINT=opc.tcp://opcua-server:4840

CMD ["python", "fmu_runner_opc.py"]





